# Lefthook Configuration
# Runs Git hooks using npx lefthook (no global installation required)
#
# Setup: pnpm run hooks:install
# Uninstall: pnpm run hooks:uninstall

# Pre-commit hook: Fast validation of staged files only
pre-commit:
  parallel: true
  commands:
    lint-staged:
      glob: "*.{ts,tsx,js,jsx,json,md}"
      run: npx lint-staged
      skip:
        - merge
        - rebase

# Pre-push hook: Comprehensive validation before pushing
# Emergency bypass: LEFTHOOK=0 git push
pre-push:
  parallel: false
  commands:
    validate-dependencies:
      run: pnpm run validate:dependencies
      skip:
        - merge
        - rebase
      timeout: 300  # 5 minutes timeout
      fail_text: |
        âŒ Dependency validation failed!
        ğŸ’¡ To fix: pnpm install --frozen-lockfile --include=optional
        ğŸš¨ Emergency bypass: LEFTHOOK=0 git push (not recommended)

    typecheck:
      run: pnpm run typecheck
      skip:
        - merge
        - rebase
      timeout: 600  # 10 minutes timeout (typecheck can be slow for large codebases)
      fail_text: |
        âŒ TypeScript errors found!
        ğŸ’¡ To fix: Review the errors above and fix type issues
        ğŸš¨ Emergency bypass: LEFTHOOK=0 git push (not recommended)

    lint:
      run: pnpm run lint
      skip:
        - merge
        - rebase
      timeout: 300  # 5 minutes timeout
      fail_text: |
        âŒ Linting errors found!
        ğŸ’¡ To fix: Run 'pnpm run lint' and address the issues
        ğŸš¨ Emergency bypass: LEFTHOOK=0 git push (not recommended)

# Commit-msg hook: Enforce conventional commit format
commit-msg:
  commands:
    conventional-commit:
      run: node scripts/validate-commit-msg.js {1}
