{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://jonshaffer.dev/wgu/catalog-data.schema.json",
  "title": "WGU Catalog Data",
  "type": "object",
  "required": ["courses", "degreePlans", "metadata"],
  "properties": {
    "courses": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/Course"
      }
    },
    "degreePlans": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/DegreePlan"
      }
    },
    "metadata": {
      "$ref": "#/definitions/Metadata"
    }
  },
  "definitions": {
    "Course": {
      "type": "object",
      "required": ["courseCode", "courseName"],
      "properties": {
        "courseCode": { "type": "string", "minLength": 2 },
        "ccn": { "type": "string" },
        "courseName": { "type": "string", "minLength": 3 },
        "description": { "type": "string" },
        "competencyUnits": { "type": "number", "minimum": 0 },
        "prerequisites": {
          "type": "array",
          "items": { "type": "string" }
        },
        "level": { "type": "string", "enum": ["undergraduate", "graduate"] },
        "academicArea": { "type": "string" },
        "metadata": {
          "type": "object",
          "properties": {
            "pageNumber": { "type": "number", "minimum": 1 },
            "rawText": { "type": "string" },
            "lastParsed": { "type": "string", "format": "date-time" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "DegreePlanCourse": {
      "type": "object",
      "required": ["courseCode", "type"],
      "properties": {
        "courseCode": { "type": "string" },
        "recommendedTerm": { "type": "number", "minimum": 1 },
        "type": { "type": "string", "enum": ["required", "elective", "capstone"] },
        "category": { "type": "string" },
        "notes": { "type": "string" }
      },
      "additionalProperties": false
    },
    "DegreePlan": {
      "type": "object",
      "required": ["degreeId", "degreeName", "degreeType", "courses", "totalCompetencyUnits", "college"],
      "properties": {
        "degreeId": { "type": "string" },
        "degreeName": { "type": "string" },
        "college": { "type": "string" },
        "degreeType": { "type": "string", "enum": ["bachelor", "master", "doctorate", "certificate"] },
        "totalCompetencyUnits": { "type": "number", "minimum": 0 },
        "courses": {
          "type": "array",
          "items": { "$ref": "#/definitions/DegreePlanCourse" }
        },
        "generalEducation": {
          "type": "array",
          "items": { "$ref": "#/definitions/DegreePlanCourse" }
        },
        "programRequirements": {
          "type": "array",
          "items": { "$ref": "#/definitions/DegreePlanCourse" }
        },
        "capstone": {
          "type": "array",
          "items": { "$ref": "#/definitions/DegreePlanCourse" }
        },
        "metadata": {
          "type": "object",
          "properties": {
            "catalogYear": { "type": "string" },
            "pageNumber": { "type": "number", "minimum": 1 },
            "rawText": { "type": "string" },
            "lastParsed": { "type": "string", "format": "date-time" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "CatalogFormatVersion": {
      "type": "object",
      "required": ["major", "minor", "patch", "identifier", "characteristics", "dateRange"],
      "properties": {
        "major": { "type": "number", "minimum": 0 },
        "minor": { "type": "number", "minimum": 0 },
        "patch": { "type": "number", "minimum": 0 },
        "identifier": { "type": "string" },
        "characteristics": {
          "type": "object",
          "required": ["courseCodePatterns", "ccnFormat", "degreeTableFormat", "textFormatNotes"],
          "properties": {
            "courseCodePatterns": {
              "type": "array",
              "items": { "type": "string" }
            },
            "ccnFormat": { "type": "string" },
            "degreeTableFormat": { "type": "string" },
            "textFormatNotes": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": false
        },
        "dateRange": {
          "type": "object",
          "properties": {
            "firstSeen": { "type": "string" },
            "lastSeen": { "type": "string" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "Metadata": {
      "type": "object",
      "required": [
        "catalogDate",
        "academicYear",
        "sourceFile",
        "parsedAt",
        "parserVersion",
        "totalPages",
        "formatVersion",
        "source",
        "parsing",
        "statistics"
      ],
      "properties": {
        "catalogDate": { "type": "string" },
        "academicYear": { "type": "string" },
        "sourceFile": { "type": "string" },
        "parsedAt": { "type": "string", "format": "date-time" },
        "parserVersion": { "type": "string" },
        "totalPages": { "type": "number", "minimum": 1 },
        "formatVersion": { "$ref": "#/definitions/CatalogFormatVersion" },
        "source": {
          "type": "object",
          "properties": {
            "sourceUrl": { "type": "string" },
            "fileSizeBytes": { "type": "number", "minimum": 0 },
            "pdfCreationDate": { "type": "string" },
            "pdfModificationDate": { "type": "string" }
          },
          "additionalProperties": false
        },
        "parsing": {
          "type": "object",
          "required": ["detectedPatterns", "performance", "compatibility"],
          "properties": {
            "detectedPatterns": {
              "type": "object",
              "properties": {
                "courseCodeFormats": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "ccnFormats": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "degreeTableFormats": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              },
              "additionalProperties": false
            },
            "performance": {
              "type": "object",
              "properties": {
                "processingTimeMs": { "type": "number", "minimum": 0 },
                "stepTimings": {
                  "type": "object",
                  "properties": {
                    "ccnExtraction": { "type": "number", "minimum": 0 },
                    "courseDescriptions": { "type": "number", "minimum": 0 },
                    "courseListings": { "type": "number", "minimum": 0 },
                    "degreePlans": { "type": "number", "minimum": 0 }
                  },
                  "additionalProperties": false
                },
                "memoryUsageMB": { "type": "number", "minimum": 0 }
              },
              "additionalProperties": false
            },
            "compatibility": {
              "type": "object",
              "properties": {
                "fullySupported": { "type": "boolean" },
                "formatDifferences": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "recommendations": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "parseErrors": {
          "type": "array",
          "items": { "type": "string" }
        },
        "statistics": {
          "type": "object",
          "required": [
            "coursesFound",
            "degreePlansFound",
            "duplicatesRemoved",
            "ccnCoverage",
            "competencyUnitsCoverage"
          ],
          "properties": {
            "coursesFound": { "type": "number", "minimum": 0 },
            "degreePlansFound": { "type": "number", "minimum": 0 },
            "duplicatesRemoved": { "type": "number", "minimum": 0 },
            "ccnCoverage": { "type": "number", "minimum": 0, "maximum": 100 },
            "competencyUnitsCoverage": { "type": "number", "minimum": 0, "maximum": 100 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  }
}
